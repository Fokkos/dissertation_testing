{% extends 'base.html' %}

{% block head %}
    <title>All Results</title>
{% endblock %}

{% block body %}
    <div class='flex space-x-4 pb-2'>
        <strong>Results</strong>
        <!-- CALCULATE distances -->
        <form action="{{ url_for('calculate_distances') }}" method="post">
        <input type="hidden" name="location" value="view_all"/>
        <div class="flex justify-center items-center">
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold rounded focus:outline-none focus:shadow-outline min-h-7 min-w-7 px-2" onclick="checkResultsValidation()" type="submit">
            Calculate
            </button>
        </div>
        </form>
    </div>
    {% if not data.results or not data.candidates or not data.voters or not data.voters[0]['distances'] %}
        <p>No results generated yet</p>
    {% else %}
        {% if data.candidates | length > 10 %}
            <p>Since there are more than 10 candidates, only the top 10 winners are displayed for each voter.
                Click on a voter's name in order to see their full results.</p>
        {% endif %}
        <table class="table-auto">
        <tbody>
            <th class="border">voter</th>
            <th class="border">winner</th>
            <th class="border">full results</th>
            <!-- show average voter -->
            <tr>
            <td class="border">Average voter</td>
            {% for distance in data.average_voter['distances'][:10] %}
                <td class="border">{{ distance[0][:20] }}: {{ distance[1]|round(4) }} </td>
            {% endfor %}
            </tr>
            {% for voter in data.voters %}
            <tr>
            <td class="border">{{ voter['id'] }}</td>
            {% for distance in voter['distances'][:10] %}
                <td class="border">{{ distance[0][:20] }}: {{ distance[1]|round(4) }} </td>
            {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
        </table>
    {% endif %}

<script>
    function checkResultsValidation() {
        if ({{ data.voters | length }} < 1 || {{ data.candidates | length }} < 2) {
        alert('Need at least 1 voter and 2 candidates to calculate results');
        return false;
        }
    }
</script>

{% endblock %}